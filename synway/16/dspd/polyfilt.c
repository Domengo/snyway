/*****************************************************************************
*             Copyright (c) 1995 - 20xx by GAO Research Inc.                 *
*                          All rights reserved.                              *
*                                                                            *
*  This program is a confidential and an unpublished work of GAO Research    *
*  Inc. that is protected under international and Canadian copyright laws.   *
*  This program is a trade secret and constitutes valuable property of GAO   *
*  Research Inc. All use, reproduction and/or disclosure in whole or in      *
*  part of this program is strictly prohibited unless expressly authorized   *
*  in writing by GAO Research Inc.                                           *
*****************************************************************************/

#include "dspdext.h"

#if SUPPORT_V34FAX
/* Timing reconstruction poly-phase filter Coef */
CONST QWORD PolyPhaseFiltCoef14[POLYCOEF_ARRAY_LEN14] =
{
    0,        0,        0,        0,        0,        0,
    32767,        0,        0,        0,        0,        0,
    0,        0,        0,       -2,       14,      -47,
    136,     -410,    32704,      519,     -211,       93,
    -36,       11,       -2,        0,        0,       -5,
    27,      -94,      270,     -807,    32615,     1053,
    -424,      186,      -72,       22,       -5,        0,
    1,       -8,       41,     -140,      401,    -1188,
    32502,     1600,     -639,      280,     -109,       34,
    -7,        0,        1,      -11,       54,     -186,
    529,    -1555,    32366,     2160,     -855,      373,
    -145,       45,      -10,        1,        1,      -14,
    68,     -230,      653,    -1906,    32205,     2732,
    -1073,      467,     -182,       57,      -12,        1,
    2,      -17,       81,     -273,      774,    -2242,
    32020,     3315,    -1290,      560,     -218,       68,
    -15,        1,        2,      -20,       93,     -315,
    890,    -2562,    31813,     3910,    -1508,      653,
    -253,       79,      -17,        2,        2,      -22,
    105,     -355,     1003,    -2867,    31582,     4516,
    -1725,      745,     -289,       90,      -20,        2,
    2,      -25,      117,     -395,     1111,    -3156,
    31328,     5131,    -1941,      836,     -323,      101,
    -22,        2,        3,      -27,      129,     -433,
    1215,    -3429,    31052,     5755,    -2156,      925,
    -358,      111,      -24,        2,        3,      -30,
    140,     -469,     1314,    -3686,    30755,     6388,
    -2368,     1014,     -391,      122,      -27,        3,
    3,      -32,      150,     -504,     1409,    -3927,
    30435,     7029,    -2579,     1100,     -424,      132,
    -29,        3,        4,      -34,      160,     -538,
    1499,    -4152,    30095,     7677,    -2786,     1185,
    -456,      141,      -31,        3,        4,      -36,
    170,     -569,     1584,    -4361,    29733,     8331,
    -2990,     1268,     -487,      151,      -33,        3,
    4,      -38,      179,     -599,     1664,    -4555,
    29352,     8991,    -3191,     1349,     -517,      160,
    -35,        4,        4,      -40,      188,     -628,
    1738,    -4732,    28951,     9656,    -3386,     1427,
    -546,      169,      -37,        4,        4,      -42,
    196,     -654,     1808,    -4894,    28530,    10325,
    -3578,     1502,     -575,      178,      -39,        4,
    5,      -44,      204,     -679,     1872,    -5040,
    28091,    10998,    -3763,     1575,     -601,      186,
    -41,        4,        5,      -45,      211,     -702,
    1931,    -5171,    27635,    11674,    -3943,     1645,
    -627,      194,      -42,        5,        5,      -47,
    217,     -723,     1984,    -5286,    27160,    12351,
    -4117,     1711,     -651,      201,      -44,        5,
    5,      -48,      223,     -742,     2032,    -5386,
    26669,    13030,    -4284,     1774,     -674,      208,
    -45,        5,        5,      -49,      229,     -759,
    2075,    -5471,    26162,    13709,    -4444,     1834,
    -696,      214,      -47,        5,        5,      -50,
    234,     -774,     2112,    -5541,    25639,    14388,
    -4596,     1890,     -716,      220,      -48,        5,
    6,      -51,      238,     -787,     2143,    -5597,
    25101,    15065,    -4740,     1942,     -734,      226,
    -49,        5,        6,      -52,      242,     -798,
    2169,    -5638,    24549,    15741,    -4876,     1990,
    -751,      231,      -50,        6,        6,      -53,
    245,     -807,     2190,    -5665,    23983,    16413,
    -5002,     2034,     -767,      235,      -51,        6,
    6,      -53,      247,     -815,     2205,    -5678,
    23405,    17083,    -5119,     2074,     -780,      239,
    -52,        6,        6,      -54,      249,     -820,
    2215,    -5678,    22815,    17747,    -5226,     2109,
    -792,      242,      -53,        6,        6,      -54,
    250,     -823,     2220,    -5664,    22213,    18407,
    -5323,     2139,     -802,      245,      -53,        6,
    6,      -54,      251,     -824,     2219,    -5637,
    21601,    19061,    -5409,     2165,     -810,      248,
    -54,        6,        6,      -54,      251,     -824,
    2213,    -5598,    20979,    19708,    -5484,     2186,
    -817,      249,      -54,        6,        6,      -54,
    250,     -821,     2202,    -5547,    20347,    20347,
    -5547,     2202,     -821,      250,      -54,        6,
    6,      -54,      249,     -817,     2186,    -5484,
    19708,    20979,    -5598,     2213,     -824,      251,
    -54,        6,        6,      -54,      248,     -810,
    2165,    -5409,    19061,    21601,    -5637,     2219,
    -824,      251,      -54,        6,        6,      -53,
    245,     -802,     2139,    -5323,    18407,    22213,
    -5664,     2220,     -823,      250,      -54,        6,
    6,      -53,      242,     -792,     2109,    -5226,
    17747,    22815,    -5678,     2215,     -820,      249,
    -54,        6,        6,      -52,      239,     -780,
    2074,    -5119,    17083,    23405,    -5678,     2205,
    -815,      247,      -53,        6,        6,      -51,
    235,     -767,     2034,    -5002,    16413,    23983,
    -5665,     2190,     -807,      245,      -53,        6,
    6,      -50,      231,     -751,     1990,    -4876,
    15741,    24549,    -5638,     2169,     -798,      242,
    -52,        6,        5,      -49,      226,     -734,
    1942,    -4740,    15065,    25101,    -5597,     2143,
    -787,      238,      -51,        6,        5,      -48,
    220,     -716,     1890,    -4596,    14388,    25639,
    -5541,     2112,     -774,      234,      -50,        5,
    5,      -47,      214,     -696,     1834,    -4444,
    13709,    26162,    -5471,     2075,     -759,      229,
    -49,        5,        5,      -45,      208,     -674,
    1774,    -4284,    13030,    26669,    -5386,     2032,
    -742,      223,      -48,        5,        5,      -44,
    201,     -651,     1711,    -4117,    12351,    27160,
    -5286,     1984,     -723,      217,      -47,        5,
    5,      -42,      194,     -627,     1645,    -3943,
    11674,    27635,    -5171,     1931,     -702,      211,
    -45,        5,        4,      -41,      186,     -601,
    1575,    -3763,    10998,    28091,    -5040,     1872,
    -679,      204,      -44,        5,        4,      -39,
    178,     -575,     1502,    -3578,    10325,    28530,
    -4894,     1808,     -654,      196,      -42,        4,
    4,      -37,      169,     -546,     1427,    -3386,
    9656,    28951,    -4732,     1738,     -628,      188,
    -40,        4,        4,      -35,      160,     -517,
    1349,    -3191,     8991,    29352,    -4555,     1664,
    -599,      179,      -38,        4,        3,      -33,
    151,     -487,     1268,    -2990,     8331,    29733,
    -4361,     1584,     -569,      170,      -36,        4,
    3,      -31,      141,     -456,     1185,    -2786,
    7677,    30095,    -4152,     1499,     -538,      160,
    -34,        4,        3,      -29,      132,     -424,
    1100,    -2579,     7029,    30435,    -3927,     1409,
    -504,      150,      -32,        3,        3,      -27,
    122,     -391,     1014,    -2368,     6388,    30755,
    -3686,     1314,     -469,      140,      -30,        3,
    2,      -24,      111,     -358,      925,    -2156,
    5755,    31052,    -3429,     1215,     -433,      129,
    -27,        3,        2,      -22,      101,     -323,
    836,    -1941,     5131,    31328,    -3156,     1111,
    -395,      117,      -25,        2,        2,      -20,
    90,     -289,      745,    -1725,     4516,    31582,
    -2867,     1003,     -355,      105,      -22,        2,
    2,      -17,       79,     -253,      653,    -1508,
    3910,    31813,    -2562,      890,     -315,       93,
    -20,        2,        1,      -15,       68,     -218,
    560,    -1290,     3315,    32020,    -2242,      774,
    -273,       81,      -17,        2,        1,      -12,
    57,     -182,      467,    -1073,     2732,    32205,
    -1906,      653,     -230,       68,      -14,        1,
    1,      -10,       45,     -145,      373,     -855,
    2160,    32366,    -1555,      529,     -186,       54,
    -11,        1,        0,       -7,       34,     -109,
    280,     -639,     1600,    32502,    -1188,      401,
    -140,       41,       -8,        1,        0,       -5,
    22,      -72,      186,     -424,     1053,    32615,
    -807,      270,      -94,       27,       -5,        0,
    0,       -2,       11,      -36,       93,     -211,
    519,    32704,     -410,      136,      -47,       14,
    -2,        0
};
#endif

#if 0
CONST QWORD PolyPhaseFiltCoef10[POLYCOEF_ARRAY_LEN10] =
{
    11,        -33,         86,       -231,      32684,        235,        -88,
    34,        -11,          4,
    31,        -99,        255,       -679,      32656,        718,       -266,
    104,        -33,         12,
    51,       -162,        419,      -1109,      32601,       1217,       -449,
    175,        -56,         21,
    69,       -222,        577,      -1522,      32518,       1733,       -637,
    249,        -79,         29,
    87,       -280,        729,      -1916,      32407,       2264,       -828,
    324,       -104,         37,
    104,       -336,        875,      -2291,      32270,       2811,      -1022,
    400,       -129,         45,
    120,       -388,       1014,      -2648,      32105,       3373,      -1219,
    478,       -155,         54,
    135,       -438,       1147,      -2986,      31914,       3948,      -1418,
    557,       -181,         62,
    149,       -485,       1274,      -3305,      31696,       4537,      -1620,
    638,       -208,         71,
    162,       -530,       1393,      -3605,      31452,       5139,      -1823,
    718,       -235,         79,
    174,       -571,       1506,      -3886,      31182,       5753,      -2027,
    800,       -263,         87,
    185,       -609,       1611,      -4147,      30887,       6379,      -2232,
    882,       -291,         95,
    195,       -645,       1710,      -4390,      30568,       7015,      -2436,
    964,       -319,        104,
    204,       -678,       1801,      -4614,      30224,       7662,      -2640,
    1046,       -347,        112,
    213,       -708,       1885,      -4818,      29856,       8317,      -2844,
    1127,       -376,        120,
    220,       -734,       1962,      -5004,      29465,       8981,      -3045,
    1209,       -405,        128,
    227,       -758,       2032,      -5172,      29052,       9653,      -3245,
    1289,       -433,        136,
    233,       -779,       2094,      -5321,      28617,      10331,      -3441,
    1368,       -462,        144,
    238,       -798,       2149,      -5452,      28161,      11015,      -3635,
    1446,       -490,        152,
    242,       -813,       2197,      -5565,      27684,      11704,      -3824,
    1523,       -518,        159,
    245,       -826,       2238,      -5660,      27188,      12397,      -4009,
    1597,       -545,        167,
    248,       -836,       2272,      -5738,      26672,      13093,      -4189,
    1670,       -572,        174,
    250,       -843,       2299,      -5799,      26139,      13791,      -4363,
    1740,       -598,        181,
    251,       -848,       2320,      -5844,      25588,      14490,      -4531,
    1808,       -624,        188,
    251,       -851,       2333,      -5873,      25021,      15190,      -4692,
    1873,       -649,        195,
    251,       -851,       2341,      -5885,      24439,      15888,      -4845,
    1935,       -673,        201,
    250,       -848,       2342,      -5883,      23842,      16585,      -4991,
    1993,       -695,        208,
    249,       -844,       2337,      -5866,      23231,      17279,      -5127,
    2048,       -717,        213,
    247,       -837,       2325,      -5834,      22608,      17969,      -5254,
    2099,       -737,        219,
    244,       -828,       2309,      -5788,      21972,      18654,      -5372,
    2146,       -757,        224,
    241,       -817,       2286,      -5729,      21326,      19333,      -5478,
    2188,       -774,        229,
    238,       -805,       2258,      -5658,      20671,      20006,      -5574,
    2226,       -790,        234,
    234,       -790,       2226,      -5574,      20006,      20671,      -5658,
    2258,       -805,        238,
    229,       -774,       2188,      -5478,      19333,      21326,      -5729,
    2286,       -817,        241,
    224,       -757,       2146,      -5372,      18654,      21972,      -5788,
    2309,       -828,        244,
    219,       -737,       2099,      -5254,      17969,      22608,      -5834,
    2325,       -837,        247,
    213,       -717,       2048,      -5127,      17279,      23231,      -5866,
    2337,       -844,        249,
    208,       -695,       1993,      -4991,      16585,      23842,      -5883,
    2342,       -848,        250,
    201,       -673,       1935,      -4845,      15888,      24439,      -5885,
    2341,       -851,        251,
    195,       -649,       1873,      -4692,      15190,      25021,      -5873,
    2333,       -851,        251,
    188,       -624,       1808,      -4531,      14490,      25588,      -5844,
    2320,       -848,        251,
    181,       -598,       1740,      -4363,      13791,      26139,      -5799,
    2299,       -843,        250,
    174,       -572,       1670,      -4189,      13093,      26672,      -5738,
    2272,       -836,        248,
    167,       -545,       1597,      -4009,      12397,      27188,      -5660,
    2238,       -826,        245,
    159,       -518,       1523,      -3824,      11704,      27684,      -5565,
    2197,       -813,        242,
    152,       -490,       1446,      -3635,      11015,      28161,      -5452,
    2149,       -798,        238,
    144,       -462,       1368,      -3441,      10331,      28617,      -5321,
    2094,       -779,        233,
    136,       -433,       1289,      -3245,       9653,      29052,      -5172,
    2032,       -758,        227,
    128,       -405,       1209,      -3045,       8981,      29465,      -5004,
    1962,       -734,        220,
    120,       -376,       1127,      -2844,       8317,      29856,      -4818,
    1885,       -708,        213,
    112,       -347,       1046,      -2640,       7662,      30224,      -4614,
    1801,       -678,        204,
    104,       -319,        964,      -2436,       7015,      30568,      -4390,
    1710,       -645,        195,
    95,       -291,        882,      -2232,       6379,      30887,      -4147,
    1611,       -609,        185,
    87,       -263,        800,      -2027,       5753,      31182,      -3886,
    1506,       -571,        174,
    79,       -235,        718,      -1823,       5139,      31452,      -3605,
    1393,       -530,        162,
    71,       -208,        638,      -1620,       4537,      31696,      -3305,
    1274,       -485,        149,
    62,       -181,        557,      -1418,       3948,      31914,      -2986,
    1147,       -438,        135,
    54,       -155,        478,      -1219,       3373,      32105,      -2648,
    1014,       -388,        120,
    45,       -129,        400,      -1022,       2811,      32270,      -2291,
    875,       -336,        104,
    37,       -104,        324,       -828,       2264,      32407,      -1916,
    729,       -280,         87,
    29,        -79,        249,       -637,       1733,      32518,      -1522,
    577,       -222,         69,
    21,        -56,        175,       -449,       1217,      32601,      -1109,
    419,       -162,         51,
    12,        -33,        104,       -266,        718,      32656,       -679,
    255,        -99,         31,
    4,        -11,         34,        -88,        235,      32684,       -231,
    86,        -33,         11
};
#endif

CONST QWORD PolyPhaseFiltCoef8[POLYCOEF_ARRAY_LEN8] =
{
    -18,         68,       -219,      32767,        224,        -70,         18,
    -5,
    -53,        201,       -644,      32738,        684,       -212,         57,
    -15,
    -85,        328,      -1050,      32681,       1162,       -360,         96,
    -26,
    -117,        450,      -1438,      32595,       1657,       -512,        138,
    -36,
    -146,        566,      -1807,      32481,       2169,       -668,        181,
    -47,
    -173,        677,      -2157,      32339,       2697,       -828,        225,
    -57,
    -199,        781,      -2488,      32170,       3240,       -992,        271,
    -68,
    -223,        880,      -2800,      31972,       3799,      -1158,        318,
    -79,
    -245,        972,      -3093,      31748,       4372,      -1328,        367,
    -90,
    -265,       1059,      -3367,      31496,       4960,      -1500,        416,
    -101,
    -283,       1139,      -3622,      31218,       5560,      -1674,        467,
    -112,
    -300,       1213,      -3858,      30915,       6173,      -1850,        519,
    -123,
    -315,       1281,      -4076,      30585,       6798,      -2027,        571,
    -134,
    -328,       1343,      -4274,      30231,       7435,      -2205,        624,
    -145,
    -340,       1399,      -4454,      29853,       8081,      -2383,        678,
    -157,
    -350,       1448,      -4616,      29451,       8738,      -2560,        732,
    -168,
    -359,       1492,      -4760,      29026,       9403,      -2738,        786,
    -179,
    -366,       1530,      -4886,      28579,      10076,      -2913,        840,
    -191,
    -372,       1562,      -4995,      28111,      10756,      -3087,        894,
    -202,
    -376,       1589,      -5086,      27622,      11442,      -3259,        948,
    -213,
    -379,       1610,      -5161,      27113,      12133,      -3428,       1001,
    -225,
    -381,       1626,      -5220,      26585,      12828,      -3593,       1053,
    -236,
    -381,       1636,      -5263,      26039,      13527,      -3755,       1105,
    -247,
    -381,       1642,      -5290,      25476,      14228,      -3911,       1156,
    -258,
    -379,       1643,      -5303,      24896,      14930,      -4063,       1205,
    -269,
    -377,       1639,      -5301,      24301,      15632,      -4209,       1253,
    -279,
    -373,       1630,      -5285,      23692,      16333,      -4348,       1299,
    -290,
    -369,       1617,      -5256,      23069,      17033,      -4480,       1343,
    -300,
    -364,       1600,      -5214,      22434,      17729,      -4605,       1385,
    -309,
    -358,       1579,      -5159,      21788,      18422,      -4721,       1425,
    -319,
    -351,       1555,      -5093,      21131,      19109,      -4829,       1462,
    -328,
    -344,       1527,      -5015,      20465,      19791,      -4927,       1496,
    -336,
    -336,       1496,      -4927,      19791,      20465,      -5015,       1527,
    -344,
    -328,       1462,      -4829,      19109,      21131,      -5093,       1555,
    -351,
    -319,       1425,      -4721,      18422,      21788,      -5159,       1579,
    -358,
    -309,       1385,      -4605,      17729,      22434,      -5214,       1600,
    -364,
    -300,       1343,      -4480,      17033,      23069,      -5256,       1617,
    -369,
    -290,       1299,      -4348,      16333,      23692,      -5285,       1630,
    -373,
    -279,       1253,      -4209,      15632,      24301,      -5301,       1639,
    -377,
    -269,       1205,      -4063,      14930,      24896,      -5303,       1643,
    -379,
    -258,       1156,      -3911,      14228,      25476,      -5290,       1642,
    -381,
    -247,       1105,      -3755,      13527,      26039,      -5263,       1636,
    -381,
    -236,       1053,      -3593,      12828,      26585,      -5220,       1626,
    -381,
    -225,       1001,      -3428,      12133,      27113,      -5161,       1610,
    -379,
    -213,        948,      -3259,      11442,      27622,      -5086,       1589,
    -376,
    -202,        894,      -3087,      10756,      28111,      -4995,       1562,
    -372,
    -191,        840,      -2913,      10076,      28579,      -4886,       1530,
    -366,
    -179,        786,      -2738,       9403,      29026,      -4760,       1492,
    -359,
    -168,        732,      -2560,       8738,      29451,      -4616,       1448,
    -350,
    -157,        678,      -2383,       8081,      29853,      -4454,       1399,
    -340,
    -145,        624,      -2205,       7435,      30231,      -4274,       1343,
    -328,
    -134,        571,      -2027,       6798,      30585,      -4076,       1281,
    -315,
    -123,        519,      -1850,       6173,      30915,      -3858,       1213,
    -300,
    -112,        467,      -1674,       5560,      31218,      -3622,       1139,
    -283,
    -101,        416,      -1500,       4960,      31496,      -3367,       1059,
    -265,
    -90,        367,      -1328,       4372,      31748,      -3093,        972,
    -245,
    -79,        318,      -1158,       3799,      31972,      -2800,        880,
    -223,
    -68,        271,       -992,       3240,      32170,      -2488,        781,
    -199,
    -57,        225,       -828,       2697,      32339,      -2157,        677,
    -173,
    -47,        181,       -668,       2169,      32481,      -1807,        566,
    -146,
    -36,        138,       -512,       1657,      32595,      -1438,        450,
    -117,
    -26,         96,       -360,       1162,      32681,      -1050,        328,
    -85,
    -15,         57,       -212,        684,      32738,       -644,        201,
    -53,
    -5,         18,        -70,        224,      32767,       -219,         68,
    -18
};

#if !USE_ASM
CQWORD Timing_Interpolation(CQWORD *pcFdptr, QWORD *pqFcoef_ptr, UBYTE Timing_Taps)
{
    UBYTE   i;
    QDWORD  qOutput_r;
    QDWORD  qOutput_i;
    CQWORD  cqOutput;

    qOutput_r = 0;
    qOutput_i = 0;

    for (i = 0; i < Timing_Taps; i++)
    {
        qOutput_r += QQMULQD(pcFdptr->r, *pqFcoef_ptr);
        qOutput_i += QQMULQD(pcFdptr->i, *pqFcoef_ptr);

        pqFcoef_ptr++;

        pcFdptr++;
    }

    cqOutput.r = QDR15Q(qOutput_r);
    cqOutput.i = QDR15Q(qOutput_i);

    return(cqOutput);
}

void PolyFilter(PolyFilterStruct *pPoly)
{
    CQWORD *Dlineptr;
    /* CQWORD cqTemp1, cqTemp2; */
    SWORD  *Coefptr;

    /* find index for start of filtering */
    Dlineptr = (CQWORD *)(pPoly->pcqTimingDlineHead + (pPoly->nTimingIdx >> TIMING_RES)) - (TIMING_TAPS8 - 1);

    Coefptr  = (SWORD *)PolyPhaseFiltCoef8 + SBQMULQ(TIMING_TAPS8, ((pPoly->nTimingIdx >> TIMELINE_RES) & TIMEFILT_INTERP));/* 19*(( -6 >> 10 ) & (11)) */

#if 0

    /* interpolate */
    if ((pPoly->nTimingIdx >> (TIMELINE_RES - 1)) & 0x0001)
    {
        cqTemp1 = Timing_Interpolation(Dlineptr, Coefptr, TIMING_TAPS8);

        Coefptr += TIMING_TAPS8;
        Dlineptr = (CQWORD *)(pPoly->pcqTimingDlineHead + ((pPoly->nTimingIdx + 64) >> TIMING_RES)) - (TIMING_TAPS8 - 1);

        if (Coefptr >= ((SWORD *)PolyPhaseFiltCoef8 + POLYCOEF_ARRAY_LEN8))
        {
            Coefptr = (SWORD *)PolyPhaseFiltCoef8;
        }

        cqTemp2 = Timing_Interpolation(Dlineptr, Coefptr, TIMING_TAPS8);

        pPoly->cqTimingIQ[pPoly->ubTimingCnt].r = (QWORD)(((QDWORD)cqTemp1.r + cqTemp2.r) >> 1);
        pPoly->cqTimingIQ[pPoly->ubTimingCnt].i = (QWORD)(((QDWORD)cqTemp1.i + cqTemp2.i) >> 1);
    }
    else
#endif
    {
        pPoly->cqTimingIQ[pPoly->ubTimingCnt] = Timing_Interpolation(Dlineptr, Coefptr, TIMING_TAPS8);
    }
}
#endif

void RX_Timing_init(PolyFilterStruct *pPoly)
{
    pPoly->nTimingIdx     = 0;
    pPoly->ubTimingCnt    = 0;
    pPoly->ubTiming_Found = 0;
}

/* ---------- Timing Loop ---------- */
void RX_TimingRecovery(PolyFilterStruct *pPoly, UBYTE ubSym_size, UBYTE ubTimingCnt_Len)
{
    /* check if next sample is in the future (not available yet!?) */
    if (pPoly->nTimingIdx >= 0)
    {
        pPoly->nTimingIdx -= ((SWORD)ubSym_size << TIMING_RES);

        pPoly->ubTiming_Found = 0;
        return;
    }

    /* acquire two samples for equalizer */
    while ((pPoly->nTimingIdx < 0) && (pPoly->ubTimingCnt < ubTimingCnt_Len))
    {
        /* store sample for equalizer input */
        PolyFilter(pPoly);

        pPoly->ubTimingCnt ++;

        /* next EQ input */
        pPoly->nTimingIdx += (SWORD)(ubSym_size >> 1) << TIMING_RES;
    }

    /* check if two samples were acquired */
    if (pPoly->ubTimingCnt > (ubTimingCnt_Len - 1))
    {
        pPoly->ubTimingCnt = 0;

        pPoly->ubTiming_Found = 1;
        return;
    }

    /* check if next sample is in the future (not available yet!?) */
    if (pPoly->nTimingIdx >= 0)
    {
        pPoly->nTimingIdx -= ((SWORD)ubSym_size << TIMING_RES);

        pPoly->ubTiming_Found = 0;
    }
}
